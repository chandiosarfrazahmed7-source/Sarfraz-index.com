<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School Attendance System</title>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js"></script>
    
    <!-- Google Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <style>
        /* ====== GLOBAL STYLES ====== */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            overflow: hidden;
            min-height: 90vh;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 16px;
        }
        
        .content {
            padding: 25px;
            min-height: 400px;
        }
        
        /* ====== BUTTON STYLES ====== */
        .btn {
            display: block;
            width: 100%;
            padding: 18px;
            margin: 15px 0;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 14px rgba(0,0,0,0.1);
        }
        
        .btn:active {
            transform: translateY(-1px);
        }
        
        .btn-teacher {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
        }
        
        .btn-admin {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }
        
        .btn-secondary {
            background: #ecf0f1;
            color: #2c3e50;
        }
        
        .btn-google {
            background: white;
            color: #757575;
            border: 2px solid #ddd;
        }
        
        .btn-google:hover {
            background: #f8f9fa;
            border-color: #ccc;
        }
        
        .google-icon {
            width: 20px;
            height: 20px;
            background: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJNMTcuNiA5LjJsLS4xLTEuOEg5djMuNGg0LjhDMTMuNiAxMiAxMyAxMyAxMiAxMy42djIuMmgzYTguOCA4LjggMCAwIDAgMi42LTYuNnoiIGZpbGw9IiM0Mjg1RjQiIGZpbGwtcnVsZT0ibm9uemVybyIvPjxwYXRoIGQ9Ik05IDE4YzIuNCAwIDQuNS0uOCA2LTIuMmwtMy0yLjJhNS40IDUuNCAwIDAgMS04LTIuOUgxVjEzYTkgOSAwIDAgMCA4IDV6IiBmaWxsPSIjMzRBODUzIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNNCAxMC43YTUuNCA1LjQgMCAwIDEgMC0zLjRWNUgxYTkgOSAwIDAgMCAwIDhsMy0yLjN6IiBmaWxsPSIjRkJCQzA1IiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNOSAzLjZjMS4zIDAgMi41LjQgMy40IDEuM0wxNSAyLjNBOSA5IDAgMCAwIDEgNWwzIDIuNGE1LjQgNS40IDAgMCAxIDUtMy43eiIgZmlsbD0iI0VBNDMzNSIgZmlsbC1ydWxlPSJub256ZXJvIi8+PHBhdGggZD0iTTAgMGgxOHYxOEgweiIvPjwvZz48L3N2Zz4=') center no-repeat;
        }
        
        .btn-logout {
            background: #95a5a6;
            color: white;
            width: auto;
            padding: 10px 20px;
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 14px;
        }
        
        /* ====== FORM STYLES ====== */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 600;
            font-size: 16px;
        }
        
        .form-input {
            width: 100%;
            padding: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        /* ====== DIVIDER ====== */
        .divider {
            display: flex;
            align-items: center;
            margin: 25px 0;
            color: #95a5a6;
        }
        
        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .divider span {
            padding: 0 15px;
            font-size: 14px;
        }
        
        /* ====== STUDENT CARD STYLES ====== */
        .student-card {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .student-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        }
        
        .student-info {
            flex: 1;
        }
        
        .student-name {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .student-details {
            font-size: 14px;
            color: #7f8c8d;
        }
        
        .attendance-buttons {
            display: flex;
            gap: 10px;
        }
        
        .status-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .status-present {
            background: #d4edda;
            color: #155724;
        }
        
        .status-absent {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        /* ====== ATTENDANCE BUTTONS ====== */
        .att-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .att-btn-present {
            background: #2ecc71;
            color: white;
        }
        
        .att-btn-absent {
            background: #e74c3c;
            color: white;
        }
        
        .att-btn-present:hover {
            background: #27ae60;
        }
        
        .att-btn-absent:hover {
            background: #c0392b;
        }
        
        /* ====== DASHBOARD CARDS ====== */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .dashboard-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        
        .card-title {
            font-size: 20px;
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .card-value {
            font-size: 36px;
            font-weight: 700;
            color: #3498db;
            margin: 10px 0;
        }
        
        .card-subtitle {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        /* ====== USER PROFILE ====== */
        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #3498db;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
            overflow: hidden;
        }
        
        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .user-info h3 {
            margin: 0;
            color: #2c3e50;
        }
        
        .user-info p {
            margin: 5px 0 0 0;
            color: #7f8c8d;
            font-size: 14px;
        }
        
        /* ====== DATE SELECTOR ====== */
        .date-selector {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            width: 100%;
            margin: 20px 0;
        }
        
        /* ====== LOADING SPINNER ====== */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ====== MESSAGE STYLES ====== */
        .message {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
            font-weight: 600;
        }
        
        .message-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .message-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .message-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        /* ====== RESPONSIVE DESIGN ====== */
        @media (max-width: 768px) {
            .content {
                padding: 15px;
            }
            
            .header {
                padding: 20px 15px;
            }
            
            .header h1 {
                font-size: 24px;
            }
            
            .student-card {
                flex-direction: column;
                align-items: stretch;
                gap: 15px;
            }
            
            .attendance-buttons {
                justify-content: center;
            }
            
            .btn-logout {
                position: relative;
                top: 0;
                right: 0;
                width: 100%;
                margin: 10px 0;
            }
        }
        
        /* ====== HIDDEN CLASS ====== */
        .hidden {
            display: none !important;
        }
        
        /* ====== LOGIN OPTIONS ====== */
        .login-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        
        .login-option-card {
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .login-option-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .login-option-card.selected {
            border-color: #3498db;
            background: #f0f8ff;
        }
        
        .login-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }
        
        .login-option-card h3 {
            margin: 10px 0 5px 0;
            color: #2c3e50;
        }
        
        .login-option-card p {
            color: #7f8c8d;
            font-size: 14px;
            margin: 0;
        }
        
        /* ====== ROLE SELECTION ====== */
        .role-selection {
            margin: 20px 0;
        }
        
        .role-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        
        .role-btn {
            padding: 12px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .role-btn:hover {
            border-color: #3498db;
            background: #f0f8ff;
        }
        
        .role-btn.selected {
            border-color: #3498db;
            background: #3498db;
            color: white;
        }
        
        /* ====== SIMPLE MODE ====== */
        .simple-mode-btn {
            background: transparent;
            border: none;
            color: #3498db;
            text-decoration: underline;
            cursor: pointer;
            font-size: 14px;
            margin-top: 15px;
            display: block;
            text-align: center;
            width: 100%;
        }
    </style>
</head>
<body>
    <!-- Main Container -->
    <div class="container" id="main-container">
        <!-- Login Screen -->
        <div id="login-screen">
            <div class="header">
                <h1>üè´ School Attendance System</h1>
                <p>Multi-Teacher Attendance Management</p>
            </div>
            
            <div class="content">
                <div style="max-width: 500px; margin: 0 auto;">
                    <h2 style="text-align: center; margin-bottom: 10px; color: #2c3e50;">Welcome</h2>
                    <p style="text-align: center; color: #7f8c8d; margin-bottom: 30px;">Choose how you want to login</p>
                    
                    <!-- Login Options -->
                    <div class="login-options">
                        <div class="login-option-card" onclick="showLogin('teacher')">
                            <div class="login-icon">üë®‚Äçüè´</div>
                            <h3>Teacher</h3>
                            <p>Mark attendance for your class</p>
                        </div>
                        
                        <div class="login-option-card" onclick="showLogin('admin')">
                            <div class="login-icon">üëë</div>
                            <h3>Admin</h3>
                            <p>View all classes attendance</p>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                        <h4 style="color: #2c3e50; margin-bottom: 10px;">Quick Login</h4>
                        <p style="color: #7f8c8d; font-size: 14px; margin-bottom: 15px;">
                            For testing, use these credentials:
                        </p>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <div style="background: white; padding: 10px; border-radius: 8px;">
                                <div style="font-weight: bold; color: #2ecc71;">Teacher</div>
                                <div style="font-size: 12px; color: #7f8c8d;">teacher1@school.com</div>
                                <div style="font-size: 12px; color: #7f8c8d;">teacher123</div>
                            </div>
                            <div style="background: white; padding: 10px; border-radius: 8px;">
                                <div style="font-weight: bold; color: #e74c3c;">Admin</div>
                                <div style="font-size: 12px; color: #7f8c8d;">admin@school.com</div>
                                <div style="font-size: 12px; color: #7f8c8d;">admin123</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Teacher Login Form -->
        <div id="teacher-login" class="hidden">
            <div class="header">
                <h1>üë®‚Äçüè´ Teacher Login</h1>
            </div>
            
            <div class="content">
                <div style="max-width: 400px; margin: 0 auto;">
                    <button class="btn btn-secondary" onclick="showScreen('login-screen')" style="margin-bottom: 20px;">
                        ‚Üê Back
                    </button>
                    
                    <div class="user-profile" id="google-user-info" style="display: none;">
                        <div class="user-avatar" id="google-user-avatar">
                            <span id="avatar-text">G</span>
                        </div>
                        <div class="user-info">
                            <h3 id="google-user-name">Google User</h3>
                            <p id="google-user-email">user@gmail.com</p>
                        </div>
                    </div>
                    
                    <!-- Google Login Button -->
                    <button class="btn btn-google" onclick="loginWithGoogle('teacher')">
                        <span class="google-icon"></span>
                        Continue with Google
                    </button>
                    
                    <div class="divider">
                        <span>or use email</span>
                    </div>
                    
                    <!-- Email Login Form -->
                    <div id="email-login-form">
                        <div class="form-group">
                            <label class="form-label">Email Address</label>
                            <input type="email" id="teacher-email" class="form-input" 
                                   placeholder="teacher@school.com" value="teacher1@school.com">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Password</label>
                            <input type="password" id="teacher-password" class="form-input" 
                                   placeholder="Enter password" value="teacher123">
                        </div>
                        
                        <div id="teacher-login-message" class="message hidden"></div>
                        
                        <button class="btn btn-primary" onclick="loginTeacher()">
                            Login as Teacher
                        </button>
                    </div>
                    
                    <!-- Role Selection for New Google Users -->
                    <div id="role-selection" class="role-selection hidden">
                        <h3 style="text-align: center; margin-bottom: 15px; color: #2c3e50;">Select Your Role</h3>
                        <p style="text-align: center; color: #7f8c8d; margin-bottom: 15px;">
                            You're logging in for the first time. Please select your role:
                        </p>
                        
                        <div class="role-buttons">
                            <div class="role-btn" onclick="selectRole('teacher')">
                                üë®‚Äçüè´ Teacher
                            </div>
                            <div class="role-btn" onclick="selectRole('admin')">
                                üëë Admin
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" onclick="confirmGoogleRole()" style="margin-top: 20px;">
                            Continue
                        </button>
                    </div>
                    
                    <button class="simple-mode-btn" onclick="showSimpleMode()">
                        Simple Mode (No Google Login)
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Admin Login Form -->
        <div id="admin-login" class="hidden">
            <div class="header">
                <h1>üëë Admin Login</h1>
            </div>
            
            <div class="content">
                <div style="max-width: 400px; margin: 0 auto;">
                    <button class="btn btn-secondary" onclick="showScreen('login-screen')" style="margin-bottom: 20px;">
                        ‚Üê Back
                    </button>
                    
                    <!-- Google Login Button -->
                    <button class="btn btn-google" onclick="loginWithGoogle('admin')">
                        <span class="google-icon"></span>
                        Continue with Google
                    </button>
                    
                    <div class="divider">
                        <span>or use email</span>
                    </div>
                    
                    <!-- Email Login Form -->
                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <input type="email" id="admin-email" class="form-input" 
                               placeholder="admin@school.com" value="admin@school.com">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" id="admin-password" class="form-input" 
                               placeholder="Enter password" value="admin123">
                    </div>
                    
                    <div id="admin-login-message" class="message hidden"></div>
                    
                    <button class="btn btn-primary" onclick="loginAdmin()">
                        Login as Admin
                    </button>
                    
                    <button class="simple-mode-btn" onclick="showSimpleMode()">
                        Simple Mode (No Google Login)
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Teacher Dashboard -->
        <div id="teacher-dashboard" class="hidden">
            <div class="header">
                <h1 id="teacher-title">Teacher Dashboard</h1>
                <p id="teacher-class-info">Loading...</p>
            </div>
            
            <div class="content">
                <button class="btn btn-logout" onclick="logout()">Logout</button>
                
                <!-- User Profile Info -->
                <div class="user-profile" id="teacher-profile">
                    <div class="user-avatar" id="teacher-avatar">
                        <span id="teacher-avatar-text">T</span>
                    </div>
                    <div class="user-info">
                        <h3 id="teacher-display-name">Teacher Name</h3>
                        <p id="teacher-email">teacher@school.com</p>
                        <p id="teacher-role" style="color: #2ecc71; font-weight: bold;">üë®‚Äçüè´ Teacher</p>
                    </div>
                </div>
                
                <div style="margin-bottom: 25px;">
                    <label class="form-label">Select Date</label>
                    <input type="date" id="attendance-date" class="date-selector">
                </div>
                
                <div id="attendance-message" class="message hidden"></div>
                
                <div id="loading-students" class="loading">
                    <div class="spinner"></div>
                </div>
                
                <div id="students-container" class="hidden">
                    <h3 style="margin-bottom: 20px; color: #2c3e50;">Mark Attendance</h3>
                    <div id="students-list"></div>
                    
                    <button id="submit-attendance-btn" class="btn btn-primary" onclick="submitAttendance()">
                        ‚úì Submit Today's Attendance
                    </button>
                    
                    <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                        <h4 style="color: #2c3e50; margin-bottom: 10px;">Today's Summary</h4>
                        <div style="display: flex; justify-content: space-between;">
                            <div>
                                <div style="font-size: 32px; font-weight: bold; color: #2ecc71;" id="present-count">0</div>
                                <div style="color: #7f8c8d;">Present</div>
                            </div>
                            <div>
                                <div style="font-size: 32px; font-weight: bold; color: #e74c3c;" id="absent-count">0</div>
                                <div style="color: #7f8c8d;">Absent</div>
                            </div>
                            <div>
                                <div style="font-size: 32px; font-weight: bold; color: #3498db;" id="total-count">0</div>
                                <div style="color: #7f8c8d;">Total</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Admin Dashboard -->
        <div id="admin-dashboard" class="hidden">
            <div class="header">
                <h1>üëë Admin Dashboard</h1>
                <p>School Attendance Overview</p>
            </div>
            
            <div class="content">
                <button class="btn btn-logout" onclick="logout()">Logout</button>
                
                <!-- User Profile Info -->
                <div class="user-profile" id="admin-profile">
                    <div class="user-avatar" id="admin-avatar">
                        <span id="admin-avatar-text">A</span>
                    </div>
                    <div class="user-info">
                        <h3 id="admin-display-name">Admin Name</h3>
                        <p id="admin-email">admin@school.com</p>
                        <p id="admin-role" style="color: #e74c3c; font-weight: bold;">üëë Administrator</p>
                    </div>
                </div>
                
                <div style="margin-bottom: 25px;">
                    <label class="form-label">Select Date</label>
                    <input type="date" id="admin-date" class="date-selector">
                </div>
                
                <div id="admin-message" class="message hidden"></div>
                
                <div id="loading-admin" class="loading">
                    <div class="spinner"></div>
                </div>
                
                <div id="admin-summary" class="hidden">
                    <!-- School Summary Card -->
                    <div class="dashboard-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                        <div class="card-title">School Overview</div>
                        <div class="card-value" id="school-total">0</div>
                        <div class="card-subtitle">Total Students Present Today</div>
                        <div style="margin-top: 20px; font-size: 14px;">
                            <span style="margin-right: 20px;">üìä <span id="school-percentage">0</span>% Attendance</span>
                            <span>üè´ <span id="total-students">0</span> Total Students</span>
                        </div>
                    </div>
                    
                    <!-- Class-wise Attendance -->
                    <h3 style="margin: 30px 0 20px 0; color: #2c3e50;">Class-wise Attendance</h3>
                    <div class="dashboard-grid" id="classes-grid">
                        <!-- Classes will be dynamically added here -->
                    </div>
                    
                    <!-- Attendance Log -->
                    <h3 style="margin: 30px 0 20px 0; color: #2c3e50;">Recent Attendance Log</h3>
                    <div id="attendance-log" style="background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.08);">
                        <div style="padding: 20px; background: #f8f9fa; border-bottom: 1px solid #e0e0e0; font-weight: 600; color: #2c3e50;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px;">
                                <div>Class</div>
                                <div>Teacher</div>
                                <div>Present/Absent</div>
                                <div>Time</div>
                            </div>
                        </div>
                        <div id="log-entries" style="max-height: 300px; overflow-y: auto;">
                            <!-- Log entries will be added here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ====== FIREBASE CONFIGURATION ====== -->
    <!-- REPLACE THIS WITH YOUR ACTUAL FIREBASE CONFIG -->
    <script>
        // ====== FIREBASE CONFIGURATION ======
        // TODO: Replace with your Firebase config from Firebase Console
        const firebaseConfig = {
            apiKey: "AIzaSyABCD1234EXAMPLE",
            authDomain: "your-project.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-project.appspot.com",
            messagingSenderId: "1234567890",
            appId: "1:1234567890:web:abc123def456"
        };
        
        // ====== GLOBAL VARIABLES ======
        let currentUser = null;
        let currentTeacherData = null;
        let students = [];
        let attendanceData = {};
        let selectedDate = new Date().toISOString().split('T')[0];
        let selectedRole = null;
        let googleUserData = null;
        
        // ====== FIREBASE INITIALIZATION ======
        try {
            const app = firebase.initializeApp(firebaseConfig);
            const auth = firebase.auth();
            const db = firebase.firestore();
        } catch (error) {
            console.log("Firebase already initialized");
        }
        
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // ====== PAGE NAVIGATION FUNCTIONS ======
        function showScreen(screenId) {
            // Hide all screens
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('teacher-login').classList.add('hidden');
            document.getElementById('admin-login').classList.add('hidden');
            document.getElementById('teacher-dashboard').classList.add('hidden');
            document.getElementById('admin-dashboard').classList.add('hidden');
            
            // Show selected screen
            document.getElementById(screenId).classList.remove('hidden');
            
            // Reset role selection
            if (screenId !== 'teacher-login') {
                document.getElementById('role-selection').classList.add('hidden');
                document.getElementById('email-login-form').classList.remove('hidden');
                document.getElementById('google-user-info').style.display = 'none';
                selectedRole = null;
                googleUserData = null;
            }
            
            // If showing teacher dashboard, load data
            if (screenId === 'teacher-dashboard') {
                loadTeacherDashboard();
            }
            
            // If showing admin dashboard, load data
            if (screenId === 'admin-dashboard') {
                loadAdminDashboard();
            }
        }
        
        function showLogin(type) {
            if (type === 'teacher') {
                showScreen('teacher-login');
            } else {
                showScreen('admin-login');
            }
        }
        
        function showSimpleMode() {
            // Reset to email login only
            document.getElementById('role-selection').classList.add('hidden');
            document.getElementById('email-login-form').classList.remove('hidden');
            document.getElementById('google-user-info').style.display = 'none';
            
            // Show message
            if (document.getElementById('teacher-login').classList.contains('hidden') === false) {
                showMessage('teacher-login-message', 'Using email login mode', 'info');
            } else {
                showMessage('admin-login-message', 'Using email login mode', 'info');
            }
        }
        
        // ====== GOOGLE LOGIN FUNCTIONS ======
        async function loginWithGoogle(loginType) {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                
                // Request additional profile info
                provider.addScope('profile');
                provider.addScope('email');
                
                // Sign in with popup
                const result = await auth.signInWithPopup(provider);
                const user = result.user;
                
                // Store user data
                googleUserData = {
                    uid: user.uid,
                    email: user.email,
                    displayName: user.displayName,
                    photoURL: user.photoURL,
                    loginType: loginType
                };
                
                // Check if user exists in database
                const userDoc = await db.collection('users').doc(user.uid).get();
                
                if (userDoc.exists) {
                    // User exists, check role
                    const userData = userDoc.data();
                    
                    if (loginType === 'teacher' && userData.role !== 'teacher') {
                        throw new Error('This Google account is not registered as a teacher');
                    }
                    
                    if (loginType === 'admin' && userData.role !== 'admin') {
                        throw new Error('This Google account is not registered as an admin');
                    }
                    
                    // Login successful
                    if (loginType === 'teacher') {
                        currentTeacherData = userData;
                        showMessage('teacher-login-message', 'Google login successful!', 'success');
                        setTimeout(() => showScreen('teacher-dashboard'), 1000);
                    } else {
                        showMessage('admin-login-message', 'Google login successful!', 'success');
                        setTimeout(() => showScreen('admin-dashboard'), 1000);
                    }
                    
                } else {
                    // New user - show role selection
                    showGoogleUserInfo();
                    
                    if (loginType === 'teacher') {
                        document.getElementById('role-selection').classList.remove('hidden');
                        document.getElementById('email-login-form').classList.add('hidden');
                    } else {
                        // For admin login, auto-select admin role
                        selectRole('admin');
                        confirmGoogleRole();
                    }
                }
                
            } catch (error) {
                console.error('Google login error:', error);
                
                if (error.code === 'auth/popup-blocked') {
                    showMessage('teacher-login-message', 'Popup blocked. Please allow popups for this site.', 'error');
                } else if (error.code === 'auth/popup-closed-by-user') {
                    // User closed the popup, do nothing
                } else {
                    showMessage('teacher-login-message', 'Google login failed: ' + error.message, 'error');
                }
            }
        }
        
        function showGoogleUserInfo() {
            if (!googleUserData) return;
            
            const userInfoDiv = document.getElementById('google-user-info');
            const avatarDiv = document.getElementById('google-user-avatar');
            const nameSpan = document.getElementById('google-user-name');
            const emailSpan = document.getElementById('google-user-email');
            const avatarText = document.getElementById('avatar-text');
            
            // Show user info
            userInfoDiv.style.display = 'flex';
            
            // Set name and email
            nameSpan.textContent = googleUserData.displayName || 'Google User';
            emailSpan.textContent = googleUserData.email;
            
            // Set avatar
            if (googleUserData.photoURL) {
                avatarDiv.innerHTML = `<img src="${googleUserData.photoURL}" alt="Profile">`;
            } else {
                avatarText.textContent = googleUserData.displayName ? googleUserData.displayName.charAt(0).toUpperCase() : 'G';
            }
        }
        
        function selectRole(role) {
            selectedRole = role;
            
            // Update UI
            document.querySelectorAll('.role-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            if (role === 'teacher') {
                document.querySelectorAll('.role-btn')[0].classList.add('selected');
            } else {
                document.querySelectorAll('.role-btn')[1].classList.add('selected');
            }
        }
        
        async function confirmGoogleRole() {
            if (!selectedRole || !googleUserData) {
                showMessage('teacher-login-message', 'Please select a role', 'error');
                return;
            }
            
            try {
                // Create user document
                const userData = {
                    email: googleUserData.email,
                    displayName: googleUserData.displayName,
                    photoURL: googleUserData.photoURL,
                    role: selectedRole,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                // Add class assignment for teachers
                if (selectedRole === 'teacher') {
                    userData.assignedClass = 'class1'; // Default class
                    userData.name = googleUserData.displayName || 'Google Teacher';
                } else {
                    userData.name = googleUserData.displayName || 'Google Admin';
                }
                
                await db.collection('users').doc(googleUserData.uid).set(userData);
                
                // Login successful
                if (selectedRole === 'teacher') {
                    currentTeacherData = userData;
                    showMessage('teacher-login-message', 'Account created successfully!', 'success');
                    setTimeout(() => showScreen('teacher-dashboard'), 1000);
                } else {
                    showMessage('admin-login-message', 'Account created successfully!', 'success');
                    setTimeout(() => showScreen('admin-dashboard'), 1000);
                }
                
            } catch (error) {
                console.error('Error creating user:', error);
                showMessage('teacher-login-message', 'Error: ' + error.message, 'error');
            }
        }
        
        // ====== AUTHENTICATION FUNCTIONS ======
        function showMessage(elementId, message, type = 'error') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `message message-${type}`;
            element.classList.remove('hidden');
            
            // Auto hide success messages after 3 seconds
            if (type === 'success') {
                setTimeout(() => {
                    element.classList.add('hidden');
                }, 3000);
            }
        }
        
        async function loginTeacher() {
            const email = document.getElementById('teacher-email').value;
            const password = document.getElementById('teacher-password').value;
            
            if (!email || !password) {
                showMessage('teacher-login-message', 'Please enter email and password', 'error');
                return;
            }
            
            try {
                showMessage('teacher-login-message', 'Logging in...', 'info');
                
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                // Check if user is a teacher
                const userDoc = await db.collection('users').doc(user.uid).get();
                
                if (!userDoc.exists) {
                    // Create user document if it doesn't exist
                    await db.collection('users').doc(user.uid).set({
                        email: email,
                        role: 'teacher',
                        name: email.split('@')[0].replace('teacher', 'Teacher '),
                        assignedClass: 'class1', // Default class
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    currentTeacherData = {
                        email: email,
                        role: 'teacher',
                        name: email.split('@')[0].replace('teacher', 'Teacher '),
                        assignedClass: 'class1'
                    };
                } else {
                    currentTeacherData = userDoc.data();
                    
                    if (currentTeacherData.role !== 'teacher') {
                        throw new Error('This account is not registered as a teacher');
                    }
                }
                
                showMessage('teacher-login-message', 'Login successful!', 'success');
                setTimeout(() => showScreen('teacher-dashboard'), 1000);
                
            } catch (error) {
                showMessage('teacher-login-message', 'Login failed: ' + error.message, 'error');
            }
        }
        
        async function loginAdmin() {
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;
            
            if (!email || !password) {
                showMessage('admin-login-message', 'Please enter email and password', 'error');
                return;
            }
            
            try {
                showMessage('admin-login-message', 'Logging in...', 'info');
                
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                // Check if user is an admin
                const userDoc = await db.collection('users').doc(user.uid).get();
                
                if (!userDoc.exists) {
                    // Create user document if it doesn't exist
                    await db.collection('users').doc(user.uid).set({
                        email: email,
                        role: 'admin',
                        name: 'School Administrator',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } else {
                    const userData = userDoc.data();
                    if (userData.role !== 'admin') {
                        throw new Error('This account is not registered as an admin');
                    }
                }
                
                showMessage('admin-login-message', 'Login successful!', 'success');
                setTimeout(() => showScreen('admin-dashboard'), 1000);
                
            } catch (error) {
                showMessage('admin-login-message', 'Login failed: ' + error.message, 'error');
            }
        }
        
        async function logout() {
            try {
                await auth.signOut();
                showScreen('login-screen');
                attendanceData = {};
                currentTeacherData = null;
                googleUserData = null;
                selectedRole = null;
            } catch (error) {
                console.error('Logout error:', error);
            }
        }
        
        // ====== UPDATE USER PROFILE DISPLAY ======
        function updateUserProfile(userData, isTeacher = true) {
            const profileId = isTeacher ? 'teacher-profile' : 'admin-profile';
            const avatarId = isTeacher ? 'teacher-avatar' : 'admin-avatar';
            const avatarTextId = isTeacher ? 'teacher-avatar-text' : 'admin-avatar-text';
            const nameId = isTeacher ? 'teacher-display-name' : 'admin-display-name';
            const emailId = isTeacher ? 'teacher-email' : 'admin-email';
            const roleId = isTeacher ? 'teacher-role' : 'admin-role';
            
            const profileDiv = document.getElementById(profileId);
            const avatarDiv = document.getElementById(avatarId);
            const avatarText = document.getElementById(avatarTextId);
            const nameSpan = document.getElementById(nameId);
            const emailSpan = document.getElementById(emailId);
            const roleSpan = document.getElementById(roleId);
            
            // Set name and email
            nameSpan.textContent = userData.displayName || userData.name || 'User';
            emailSpan.textContent = userData.email || '';
            roleSpan.textContent = isTeacher ? 'üë®‚Äçüè´ Teacher' : 'üëë Administrator';
            
            // Set avatar
            if (userData.photoURL) {
                avatarDiv.innerHTML = `<img src="${userData.photoURL}" alt="Profile">`;
            } else {
                const displayName = userData.displayName || userData.name || 'User';
                avatarText.textContent = displayName.charAt(0).toUpperCase();
            }
        }
        
        // ====== TEACHER DASHBOARD FUNCTIONS ======
        async function loadTeacherDashboard() {
            try {
                const user = auth.currentUser;
                if (!user) {
                    showScreen('login-screen');
                    return;
                }
                
                // Get teacher data
                const userDoc = await db.collection('users').doc(user.uid).get();
                if (userDoc.exists) {
                    currentTeacherData = userDoc.data();
                    
                    // Update UI
                    document.getElementById('teacher-title').textContent = 
                        `Welcome, ${currentTeacherData.name || currentTeacherData.displayName || 'Teacher'}`;
                    document.getElementById('teacher-class-info').textContent = 
                        `Class: ${currentTeacherData.assignedClass || 'Not Assigned'}`;
                    
                    // Update profile display
                    updateUserProfile(currentTeacherData, true);
                }
                
                // Set default date
                document.getElementById('attendance-date').value = selectedDate;
                
                // Load students
                await loadStudentsForClass();
                
                // Load existing attendance for today
                await loadTodayAttendance();
                
            } catch (error) {
                console.error('Error loading teacher dashboard:', error);
                showMessage('attendance-message', 'Error loading dashboard: ' + error.message, 'error');
            }
        }
        
        async function loadStudentsForClass() {
            try {
                document.getElementById('loading-students').classList.remove('hidden');
                document.getElementById('students-container').classList.add('hidden');
                
                if (!currentTeacherData || !currentTeacherData.assignedClass) {
                    throw new Error('Teacher not assigned to any class');
                }
                
                const classId = currentTeacherData.assignedClass;
                
                // Load class details
                const classDoc = await db.collection('classes').doc(classId).get();
                if (classDoc.exists) {
                    const classData = classDoc.data();
                    document.getElementById('total-count').textContent = classData.totalStudents || 0;
                }
                
                // Load students
                const studentsSnapshot = await db.collection('students')
                    .where('classId', '==', classId)
                    .orderBy('rollNumber')
                    .get();
                
                students = [];
                studentsSnapshot.forEach(doc => {
                    students.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                // Display students
                displayStudentsList();
                
                document.getElementById('loading-students').classList.add('hidden');
                document.getElementById('students-container').classList.remove('hidden');
                
            } catch (error) {
                console.error('Error loading students:', error);
                showMessage('attendance-message', 'Error loading students: ' + error.message, 'error');
            }
        }
        
        function displayStudentsList() {
            const container = document.getElementById('students-list');
            container.innerHTML = '';
            
            let presentCount = 0;
            let absentCount = 0;
            
            students.forEach(student => {
                const attendanceStatus = attendanceData[student.id];
                
                const card = document.createElement('div');
                card.className = 'student-card';
                card.innerHTML = `
                    <div class="student-info">
                        <div class="student-name">${student.rollNumber}. ${student.name}</div>
                        <div class="student-details">ID: ${student.studentId || student.id.substring(0, 8)}</div>
                    </div>
                    <div class="attendance-buttons">
                        <span class="status-badge ${attendanceStatus === true ? 'status-present' : 
                            attendanceStatus === false ? 'status-absent' : 'status-pending'}">
                            ${attendanceStatus === true ? 'PRESENT' : 
                             attendanceStatus === false ? 'ABSENT' : 'NOT MARKED'}
                        </span>
                        <button class="att-btn att-btn-present" 
                                onclick="markStudentAttendance('${student.id}', true)">
                            Present
                        </button>
                        <button class="att-btn att-btn-absent" 
                                onclick="markStudentAttendance('${student.id}', false)">
                            Absent
                        </button>
                    </div>
                `;
                
                container.appendChild(card);
                
                // Update counts
                if (attendanceStatus === true) presentCount++;
                if (attendanceStatus === false) absentCount++;
            });
            
            // Update counts display
            document.getElementById('present-count').textContent = presentCount;
            document.getElementById('absent-count').textContent = absentCount;
        }
        
        async function loadTodayAttendance() {
            try {
                if (!currentTeacherData || !currentTeacherData.assignedClass) return;
                
                const classId = currentTeacherData.assignedClass;
                
                // Load attendance for selected date
                const attendanceSnapshot = await db.collection('attendance')
                    .where('date', '==', selectedDate)
                    .where('classId', '==', classId)
                    .limit(1)
                    .get();
                
                attendanceData = {};
                
                if (!attendanceSnapshot.empty) {
                    const attendanceDoc = attendanceSnapshot.docs[0];
                    const data = attendanceDoc.data();
                    
                    // Mark present students
                    if (data.presentStudents) {
                        data.presentStudents.forEach(studentId => {
                            attendanceData[studentId] = true;
                        });
                    }
                    
                    // Mark absent students
                    if (data.absentStudents) {
                        data.absentStudents.forEach(studentId => {
                            attendanceData[studentId] = false;
                        });
                    }
                    
                    showMessage('attendance-message', 
                        `Attendance already submitted for today at ${data.timestamp?.toDate().toLocaleTimeString() || 'unknown time'}`, 
                        'info');
                }
                
                displayStudentsList();
                
            } catch (error) {
                console.error('Error loading attendance:', error);
            }
        }
        
        function markStudentAttendance(studentId, isPresent) {
            attendanceData[studentId] = isPresent;
            displayStudentsList();
            
            // Show feedback
            const student = students.find(s => s.id === studentId);
            if (student) {
                showMessage('attendance-message', 
                    `Marked ${student.name} as ${isPresent ? 'Present' : 'Absent'}`, 
                    'success');
            }
        }
        
        async function submitAttendance() {
            try {
                if (!currentTeacherData || !currentTeacherData.assignedClass) {
                    throw new Error('Teacher not assigned to any class');
                }
                
                // Check if all students are marked
                const unmarkedStudents = students.filter(student => 
                    attendanceData[student.id] === undefined
                );
                
                if (unmarkedStudents.length > 0) {
                    const shouldContinue = confirm(
                        `${unmarkedStudents.length} students not marked. Submit anyway?`
                    );
                    if (!shouldContinue) return;
                }
                
                // Prepare present and absent arrays
                const presentStudents = [];
                const absentStudents = [];
                
                students.forEach(student => {
                    if (attendanceData[student.id] === true) {
                        presentStudents.push(student.id);
                    } else if (attendanceData[student.id] === false) {
                        absentStudents.push(student.id);
                    }
                });
                
                // Create attendance record
                const attendanceRecord = {
                    date: selectedDate,
                    classId: currentTeacherData.assignedClass,
                    teacherId: auth.currentUser.uid,
                    teacherName: currentTeacherData.name || currentTeacherData.displayName,
                    presentStudents: presentStudents,
                    absentStudents: absentStudents,
                    totalPresent: presentStudents.length,
                    totalAbsent: absentStudents.length,
                    totalStudents: students.length,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                // Save to Firestore
                await db.collection('attendance').add(attendanceRecord);
                
                showMessage('attendance-message', 
                    `Attendance submitted successfully! ${presentStudents.length} present, ${absentStudents.length} absent`, 
                    'success');
                
            } catch (error) {
                console.error('Error submitting attendance:', error);
                showMessage('attendance-message', 'Error submitting attendance: ' + error.message, 'error');
            }
        }
        
        // ====== ADMIN DASHBOARD FUNCTIONS ======
        async function loadAdminDashboard() {
            try {
                const user = auth.currentUser;
                if (!user) {
                    showScreen('login-screen');
                    return;
                }
                
                // Get admin data
                const userDoc = await db.collection('users').doc(user.uid).get();
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    updateUserProfile(userData, false);
                }
                
                // Set default date
                document.getElementById('admin-date').value = selectedDate;
                document.getElementById('admin-date').addEventListener('change', function() {
                    selectedDate = this.value;
                    loadAdminData();
                });
                
                // Load initial data
                await loadAdminData();
                
            } catch (error) {
                console.error('Error loading admin dashboard:', error);
                showMessage('admin-message', 'Error loading dashboard: ' + error.message, 'error');
            }
        }
        
        async function loadAdminData() {
            try {
                document.getElementById('loading-admin').classList.remove('hidden');
                document.getElementById('admin-summary').classList.add('hidden');
                
                // Load all classes
                const classesSnapshot = await db.collection('classes').get();
                const classes = [];
                classesSnapshot.forEach(doc => {
                    classes.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                // Load attendance for selected date
                const attendanceSnapshot = await db.collection('attendance')
                    .where('date', '==', selectedDate)
                    .orderBy('timestamp', 'desc')
                    .get();
                
                const attendanceByClass = {};
                let totalSchoolPresent = 0;
                let totalSchoolStudents = 0;
                
                classes.forEach(cls => {
                    attendanceByClass[cls.id] = {
                        className: cls.className,
                        totalStudents: cls.totalStudents || 0,
                        present: 0,
                        absent: 0
                    };
                    totalSchoolStudents += cls.totalStudents || 0;
                });
                
                // Process attendance records
                attendanceSnapshot.forEach(doc => {
                    const data = doc.data();
                    const classId = data.classId;
                    
                    if (attendanceByClass[classId]) {
                        attendanceByClass[classId].present = data.totalPresent || 0;
                        attendanceByClass[classId].absent = data.totalAbsent || 0;
                        attendanceByClass[classId].teacherName = data.teacherName;
                        attendanceByClass[classId].timestamp = data.timestamp;
                        
                        totalSchoolPresent += data.totalPresent || 0;
                    }
                });
                
                // Update school overview
                document.getElementById('school-total').textContent = totalSchoolPresent;
                document.getElementById('total-students').textContent = totalSchoolStudents;
                
                const percentage = totalSchoolStudents > 0 ? 
                    Math.round((totalSchoolPresent / totalSchoolStudents) * 100) : 0;
                document.getElementById('school-percentage').textContent = percentage;
                
                // Update class-wise attendance
                displayClassAttendance(classes, attendanceByClass);
                
                // Update attendance log
                displayAttendanceLog(attendanceSnapshot);
                
                document.getElementById('loading-admin').classList.add('hidden');
                document.getElementById('admin-summary').classList.remove('hidden');
                
            } catch (error) {
                console.error('Error loading admin data:', error);
                showMessage('admin-message', 'Error loading data: ' + error.message, 'error');
            }
        }
        
        function displayClassAttendance(classes, attendanceByClass) {
            const container = document.getElementById('classes-grid');
            container.innerHTML = '';
            
            classes.forEach(cls => {
                const attendance = attendanceByClass[cls.id] || {
                    className: cls.className,
                    totalStudents: cls.totalStudents || 0,
                    present: 0,
                    absent: 0,
                    teacherName: 'Not submitted'
                };
                
                const percentage = attendance.totalStudents > 0 ? 
                    Math.round((attendance.present / attendance.totalStudents) * 100) : 0;
                
                const card = document.createElement('div');
                card.className = 'dashboard-card';
                card.innerHTML = `
                    <div class="card-title">${attendance.className}</div>
                    <div class="card-value">${attendance.present}/${attendance.totalStudents}</div>
                    <div class="card-subtitle">Present Students</div>
                    <div style="margin-top: 15px;">
                        <div style="background: #ecf0f1; height: 10px; border-radius: 5px; overflow: hidden;">
                            <div style="width: ${percentage}%; background: ${percentage >= 80 ? '#2ecc71' : percentage >= 60 ? '#f39c12' : '#e74c3c'}; height: 100%;"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 10px; font-size: 14px;">
                            <span>${percentage}% Attendance</span>
                            <span>üë®‚Äçüè´ ${attendance.teacherName}</span>
                        </div>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }
        
        function displayAttendanceLog(attendanceSnapshot) {
            const container = document.getElementById('log-entries');
            container.innerHTML = '';
            
            if (attendanceSnapshot.empty) {
                container.innerHTML = `
                    <div style="padding: 40px; text-align: center; color: #7f8c8d;">
                        No attendance records for ${selectedDate}
                    </div>
                `;
                return;
            }
            
            attendanceSnapshot.forEach(doc => {
                const data = doc.data();
                const time = data.timestamp ? 
                    data.timestamp.toDate().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : 
                    'Unknown time';
                
                const entry = document.createElement('div');
                entry.style.padding = '15px 20px';
                entry.style.borderBottom = '1px solid #f0f0f0';
                entry.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px; align-items: center;">
                        <div>${data.classId || 'Unknown'}</div>
                        <div>${data.teacherName || 'Unknown'}</div>
                        <div>
                            <span style="color: #2ecc71; font-weight: bold;">${data.totalPresent || 0}</span> / 
                            <span style="color: #e74c3c; font-weight: bold;">${data.totalAbsent || 0}</span>
                        </div>
                        <div>${time}</div>
                    </div>
                `;
                
                container.appendChild(entry);
            });
        }
        
        // ====== ENABLE GOOGLE AUTHENTICATION ======
        async function enableGoogleAuth() {
            // Instructions to enable Google Auth in Firebase
            console.log("To enable Google Login:");
            console.log("1. Go to Firebase Console ‚Üí Authentication");
            console.log("2. Click 'Sign-in method' tab");
            console.log("3. Click 'Google'");
            console.log("4. Enable it");
            console.log("5. Add your support email");
            console.log("6. Click 'Save'");
        }
        
        // ====== EVENT LISTENERS ======
        document.addEventListener('DOMContentLoaded', function() {
            // Set default date to today
            const today = new Date().toISOString().split('T')[0];
            selectedDate = today;
            
            // Check if user is already logged in
            auth.onAuthStateChanged(async (user) => {
                if (user) {
                    // User is signed in
                    const userDoc = await db.collection('users').doc(user.uid).get();
                    if (userDoc.exists) {
                        const userData = userDoc.data();
                        if (userData.role === 'teacher') {
                            currentTeacherData = userData;
                            showScreen('teacher-dashboard');
                        } else if (userData.role === 'admin') {
                            showScreen('admin-dashboard');
                        } else {
                            // User has no role assigned
                            await auth.signOut();
                            showScreen('login-screen');
                        }
                    } else {
                        // User document doesn't exist
                        await auth.signOut();
                        showScreen('login-screen');
                    }
                } else {
                    // User is signed out
                    showScreen('login-screen');
                }
            });
            
            // Teacher date selector change
            document.getElementById('attendance-date')?.addEventListener('change', function() {
                selectedDate = this.value;
                loadTodayAttendance();
            });
            
            // Admin date selector change
            document.getElementById('admin-date')?.addEventListener('change', function() {
                selectedDate = this.value;
                loadAdminData();
            });
            
            // Enter key support for login forms
            document.getElementById('teacher-password')?.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') loginTeacher();
            });
            
            document.getElementById('admin-password')?.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') loginAdmin();
            });
            
            // Setup demo data button (for testing)
            const setupBtn = document.createElement('button');
            setupBtn.textContent = 'Setup Demo Data';
            setupBtn.style.cssText = `
                position: fixed; bottom: 20px; right: 20px; 
                background: #9b59b6; color: white; border: none;
                padding: 10px 15px; border-radius: 5px; cursor: pointer;
                font-size: 12px; z-index: 1000;
            `;
            setupBtn.onclick = setupDemoData;
            document.body.appendChild(setupBtn);
            
            // Enable Google Auth button
            const googleAuthBtn = document.createElement('button');
            googleAuthBtn.textContent = 'Enable Google Login';
            googleAuthBtn.style.cssText = `
                position: fixed; bottom: 60px; right: 20px; 
                background: #4285F4; color: white; border: none;
                padding: 10px 15px; border-radius: 5px; cursor: pointer;
                font-size: 12px; z-index: 1000;
            `;
            googleAuthBtn.onclick = enableGoogleAuth;
            document.body.appendChild(googleAuthBtn);
        });
        
        // ====== DEMO DATA SETUP FUNCTION ======
        async function setupDemoData() {
            try {
                const user = auth.currentUser;
                if (!user) {
                    alert('Please login as admin first');
                    return;
                }
                
                // Check if admin
                const userDoc = await db.collection('users').doc(user.uid).get();
                if (!userDoc.exists || userDoc.data().role !== 'admin') {
                    alert('Admin access required');
                    return;
                }
                
                if (!confirm('This will create demo classes and students. Continue?')) {
                    return;
                }
                
                // Create classes
                const classes = [
                    { id: 'class1', className: 'Class 1', totalStudents: 40 },
                    { id: 'class2', className: 'Class 2', totalStudents: 42 },
                    { id: 'class3', className: 'Class 3', totalStudents: 38 },
                    { id: 'class4', className: 'Class 4', totalStudents: 45 },
                    { id: 'class5', className: 'Class 5', totalStudents: 40 },
                    { id: 'class6', className: 'Class 6', totalStudents: 35 }
                ];
                
                for (const cls of classes) {
                    await db.collection('classes').doc(cls.id).set({
                        className: cls.className,
                        totalStudents: cls.totalStudents,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
                
                // Create sample students
                const studentNames = [
                    'Aarav Sharma', 'Vihaan Patel', 'Aditya Kumar', 'Vivaan Gupta', 
                    'Arjun Singh', 'Sai Reddy', 'Reyansh Joshi', 'Mohan Das',
                    'Aryan Mehta', 'Ishaan Nair', 'Ananya Desai', 'Aadhya Rao',
                    'Diya Choudhary', 'Ira Malhotra', 'Kiara Verma', 'Myra Bhat',
                    'Pari Srinivasan', 'Riya Iyer', 'Sara Menon', 'Tara Kapoor'
                ];
                
                // Clear existing students
                const existingStudents = await db.collection('students').get();
                const batch = db.batch();
                existingStudents.docs.forEach(doc => {
                    batch.delete(doc.ref);
                });
                await batch.commit();
                
                // Add new students
                let studentCounter = 1;
                
                for (let classNum = 1; classNum <= 6; classNum++) {
                    for (let i = 0; i < 10; i++) {
                        const studentId = 'S' + studentCounter.toString().padStart(3, '0');
                        const nameIndex = (studentCounter - 1) % studentNames.length;
                        
                        await db.collection('students').add({
                            studentId: studentId,
                            name: studentNames[nameIndex] + ' - C' + classNum,
                            classId: 'class' + classNum,
                            rollNumber: i + 1,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        
                        studentCounter++;
                    }
                }
                
                alert('Demo data setup complete! Created 6 classes with 10 students each.');
                
                // Refresh admin dashboard
                if (document.getElementById('admin-dashboard').classList.contains('hidden') === false) {
                    loadAdminData();
                }
                
            } catch (error) {
                console.error('Error setting up demo data:', error);
                alert('Error: ' + error.message);
            }
        }
    </script>
</body>
</html>